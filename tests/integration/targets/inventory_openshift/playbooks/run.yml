---
- name: Verify inventory and connection plugins
  # This group is created by the openshift_inventory plugin
  # It is automatically configured to use the `oc` connection plugin
  hosts: namespace_inventory-test_pods
  gather_facts: no
  vars:
    file_content: |
      Hello world
  tasks:
    - name: End play if host not running (TODO should we not add these to the inventory?)
      meta: end_host
      when: pod_phase != "Running"

    - setup:
      vars:
        ansible_python_interpreter: auto

    - debug: var=ansible_facts

    - name: Assert the TEST environment variable was retrieved
      assert:
        that: ansible_facts.env.TEST == 'test'

    - name: Copy a file into the host
      copy:
        content: '{{ file_content }}'
        dest: /tmp/test_file
      vars:
        ansible_python_interpreter: auto

    - name: Retrieve the file from the host
      slurp:
        src: /tmp/test_file
      register: slurped_file
      vars:
        ansible_python_interpreter: auto

    - name: Assert the file content matches expectations
      assert:
        that: (slurped_file.content|b64decode) == file_content